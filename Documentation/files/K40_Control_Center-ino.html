<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>K40_Control_Center.ino</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="K40_Control_Center.ino"></a><a name="Topic44"></a><div class="CTopic TFile LC first">
 <div class="CTitle">K40 Control Center.ino</div>
</div>

<a name="Chinese_Co2_Laser_Control_Center"></a><a name="Topic57"></a><div class="CTopic TFile LC">
 <div class="CTitle">Chinese Co2 Laser Control Center</div>
 <div class="CBody"><div class="CHeading">Author</div><p>Will Travis</p><div class="CHeading">Date</div><p>06-25-2018</p><div class="CHeading">Version</div><p>0.15</p><div class="CHeading">See Also</div><p>See instruction file for hookup information.</p><div class="CHeading">Description</div><p>When modifying my K40, I wanted to have a display with information on different aspects of the K40, so I decided to use the Nextion display.&nbsp; It works great with an Arduino that can be used read many sensors of data.&nbsp; This program displays that information and allows interaction with buttons and other items...</p><div class="CHeading">Docs</div><p>Documentation created by NaturalDocs.org.&nbsp; Documentation style follows Arduino standard, including:</p><ul><li><p>Variable names start with a lower-case letter, use uppercase letters as separators and do not use underbars ('_').</p></li><li><p>Function names start with a lower-case letter, use uppercase letters as separators and do not use underbars ('_').</p></li><li><p>Constant names use all capital letters and use underbars ('_') as separators.</p></li><li><p>Using byte, int, unsigned int, etc. vs. int8_t, uint8_t, etc.</p></li><li><p>Avoiding the use of defines as much as possible.</p></li><li><p>Using const instead of define.</p></li></ul></div>
</div>

<a name="Include_files"></a><a name="Topic46"></a><div class="CTopic TFile LC">
 <div class="CTitle">Include files</div>
 <div class="CBody"><table class="CDefinitionList"><tr><td class="CDLEntry"><a name="K40_Control_Center.h"></a><a name="Topic47"></a>K40_Control_Center.h</td><td class="CDLDefinition"><p>main configuration file</p></td></tr><tr><td class="CDLEntry"><a name="Nextion.h"></a><a name="Topic48"></a>Nextion.h</td><td class="CDLDefinition"><p>Nextion display</p></td></tr><tr><td class="CDLEntry"><a name="Flow"></a><a name="Topic49"></a>Flow</td><td class="CDLDefinition"><p>water flow library</p></td></tr></table></div>
</div>

<a name="Variables"></a><a name="Topic50"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Variables</div>
</div>

<a name="Global_Variables"></a><a name="Topic101"></a><div class="CTopic TVariable LC">
 <div class="CTitle">Global Variables</div>
 <div class="CBody"><table class="CDefinitionList"><tr><td class="CDLEntry"><a name="prev_fault"></a><a name="Topic52"></a>prev_fault</td><td class="CDLDefinition"><p>Used to display faults only when changing</p></td></tr><tr><td class="CDLEntry"><a name="flowAni"></a><a name="Topic53"></a>flowAni</td><td class="CDLDefinition"><p>used to animate flow graphics</p></td></tr><tr><td class="CDLEntry"><a name="celcius"></a><a name="Topic60"></a>celcius</td><td class="CDLDefinition"><p>Celcius = 0, Fahrenheit = 1</p></td></tr><tr><td class="CDLEntry"><a name="caseADC"></a><a name="Topic61"></a>caseADC</td><td class="CDLDefinition"><p>used to average Analog to Digital temp readings</p></td></tr><tr><td class="CDLEntry"><a name="waterADC"></a><a name="Topic62"></a>waterADC</td><td class="CDLDefinition"><p>used to average Analog to Digital temp readings</p></td></tr><tr><td class="CDLEntry"><a name="tempCount"></a><a name="Topic63"></a>tempCount</td><td class="CDLDefinition"><p>used to count readings for NUM_SAMPLES times</p></td></tr><tr><td class="CDLEntry"><a name="prevMillis"></a><a name="Topic64"></a>prevMillis</td><td class="CDLDefinition"><p>used to determine when to do a function (stores milliseconds)</p></td></tr><tr><td class="CDLEntry"><a name="last_read_temp"></a><a name="Topic65"></a>last_read_temp</td><td class="CDLDefinition"><p>reads thermistor time since last changed</p></td></tr><tr><td class="CDLEntry"><a name="doorOpen"></a><a name="Topic43"></a>doorOpen</td><td class="CDLDefinition"><p>true if the door is open, false = door is closed</p></td></tr><tr><td class="CDLEntry"><a name="keySwitchOpen"></a><a name="Topic73"></a>keySwitchOpen</td><td class="CDLDefinition"><p>true if key switch is open, false if key closed</p></td></tr><tr><td class="CDLEntry"><a name="waterHighAlarm"></a><a name="Topic76"></a>waterHighAlarm</td><td class="CDLDefinition"><p>true if water temp too HIGH</p></td></tr><tr><td class="CDLEntry"><a name="waterLowAlarm"></a><a name="Topic77"></a>waterLowAlarm</td><td class="CDLDefinition"><p>true if water temp too LOW</p></td></tr><tr><td class="CDLEntry"><a name="caseHighAlarm"></a><a name="Topic30"></a>caseHighAlarm</td><td class="CDLDefinition"><p>true if case temp too HIGH</p></td></tr><tr><td class="CDLEntry"><a name="caseLowAlarm"></a><a name="Topic31"></a>caseLowAlarm</td><td class="CDLDefinition"><p>true if case temp too LOW</p></td></tr><tr><td class="CDLEntry"><a name="peltierOn"></a><a name="Topic102"></a>peltierOn</td><td class="CDLDefinition"><p>indicates if peltier is ON</p></td></tr></table></div>
</div>

<a name="Nextion_components_for_home_page"></a><a name="Topic79"></a><div class="CTopic TVariable LC">
 <div class="CTitle">Nextion components for home page</div>
 <div class="CBody"><table class="CDefinitionList"><tr><td class="CDLEntry"><a name="selfcheck_page"></a><a name="Topic54"></a>selfcheck_page</td><td class="CDLDefinition"><p>Displayed on startup, checks if sensors working</p></td></tr><tr><td class="CDLEntry"><a name="celcius_va"></a><a name="Topic58"></a>celcius_va</td><td class="CDLDefinition"><p>Celcius vs Fahrenheit</p></td></tr><tr><td class="CDLEntry"><a name="home"></a><a name="Topic68"></a>home</td><td class="CDLDefinition"><p>Home page</p></td></tr><tr><td class="CDLEntry"><a name="lights_btn"></a><a name="Topic69"></a>lights_btn</td><td class="CDLDefinition"><p>Button to turn interior lights on and off</p></td></tr><tr><td class="CDLEntry"><a name="assist_btn"></a><a name="Topic92"></a>assist_btn</td><td class="CDLDefinition"><p>Button to turn air assist on and off</p></td></tr><tr><td class="CDLEntry"><a name="pointer_btn"></a><a name="Topic93"></a>pointer_btn</td><td class="CDLDefinition"><p>Button to turn laser pointer on and off</p></td></tr><tr><td class="CDLEntry"><a name="exhaust_btn"></a><a name="Topic94"></a>exhaust_btn</td><td class="CDLDefinition"><p>Button to turn exhaust fan on and off</p></td></tr><tr><td class="CDLEntry"><a name="status_txt"></a><a name="Topic70"></a>status_txt</td><td class="CDLDefinition"><p>Text line at bottom of display used to display error MESSAGES</p></td></tr><tr><td class="CDLEntry"><a name="water_temp"></a><a name="Topic71"></a>water_temp</td><td class="CDLDefinition"><p>Displays water temp (string to display floating point number)</p></td></tr><tr><td class="CDLEntry"><a name="case_temp_num"></a><a name="Topic72"></a>case_temp_num</td><td class="CDLDefinition"><p>Displays case temp (integer number)</p></td></tr></table></div>
</div>

<a name="nex_listen_list"></a><a name="Topic67"></a><div class="CTopic TVariable LC">
 <div class="CTitle">nex_listen_list</div>
 <div id="NDPrototype67" class="NDPrototype NoParameterForm">NexTouch *nex_listen_list[]</div>
 <div class="CBody"><p>List of all Nextion objects that will return a value, e.g. buttons</p></div>
</div>

<a name="Functions"></a><a name="Topic55"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="display_status"></a><a name="Topic80"></a><div class="CTopic TFunction LC">
 <div class="CTitle">display_status</div>
 <div id="NDPrototype80" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> display_status(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">int</span>&nbsp;</td><td class="PName last">fault</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Displays message on status line at bottom of Nextion display</p><div class="CHeading">Argument</div><table class="CDefinitionList"><tr><td class="CDLEntry">fault<div class="CDLParameterType"><span class="SHKeyword">int</span></div></td><td class="CDLDefinition"><p>number of message to display from MESSAGES array</p></td></tr></table></div>
</div>

<a name="selfCheck"></a><a name="Topic29"></a><div class="CTopic TFunction LC">
 <div class="CTitle">selfCheck</div>
 <div id="NDPrototype29" class="NDPrototype NoParameterForm"><span class="SHKeyword">void</span> selfCheck()</div>
 <div class="CBody"><p>Checks if all systems are running.&nbsp; Checking off each system on the Nextion display.&nbsp; Will only test systems that do not have Bypass set to true.&nbsp; When complete, will display home page.</p></div>
</div>

<a name="lights_btnPopCallback"></a><a name="Topic78"></a><div class="CTopic TFunction LC">
 <div class="CTitle">lights_btnPopCallback</div>
 <div id="NDPrototype78" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> lights_btnPopCallback(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Turn the LED lights on or off based on the value of the lights button.</p></div>
</div>

<a name="assist_btnPopCallback"></a><a name="Topic95"></a><div class="CTopic TFunction LC">
 <div class="CTitle">assist_btnPopCallback</div>
 <div id="NDPrototype95" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> assist_btnPopCallback(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Turn the air assist on or off based on the value of the dual state button.</p></div>
</div>

<a name="pointer_btnPopCallback"></a><a name="Topic96"></a><div class="CTopic TFunction LC">
 <div class="CTitle">pointer_btnPopCallback</div>
 <div id="NDPrototype96" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> pointer_btnPopCallback(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Turn the laser pointer on or off based on the value of the laser button.</p></div>
</div>

<a name="exhaust_btnPopCallback"></a><a name="Topic97"></a><div class="CTopic TFunction LC">
 <div class="CTitle">exhaust_btnPopCallback</div>
 <div id="NDPrototype97" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> exhaust_btnPopCallback(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">void</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">ptr</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Turn the exhaust fan on or off based on the value of the exhaust button.</p></div>
</div>

<a name="readSettings"></a><a name="Topic59"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readSettings</div>
 <div id="NDPrototype59" class="NDPrototype NoParameterForm"><span class="SHKeyword">void</span> readSettings()</div>
 <div class="CBody"><p>Reads settings from Nextion</p></div>
</div>

<a name="readThermistors"></a><a name="Topic51"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readThermistors</div>
 <div id="NDPrototype51" class="NDPrototype NoParameterForm"><span class="SHKeyword">bool</span> readThermistors()</div>
 <div class="CBody"><p>Read a values from both water and case thermistors, if it has read multiple values up to NUM_SAMPLES of times then calculate average in global variables waterADC and caseADC</p><div class="CHeading">Returns</div><p>true if temperature is read NUM_SAMPLES times false if not all samples have been read</p><div class="CHeading">Global Variables</div><table class="CDefinitionList"><tr><td class="CDLEntry">waterADC</td><td class="CDLDefinition"><p>running total of raw temp reads from water thermistor</p></td></tr><tr><td class="CDLEntry">caseADC</td><td class="CDLDefinition"><p>running total of raw temp reads from case thermistor</p></td></tr><tr><td class="CDLEntry">WATER_TEMP_PIN</td><td class="CDLDefinition"><p>Arduino pin of water thermistor</p></td></tr><tr><td class="CDLEntry">CASE_TEMP_PIN</td><td class="CDLDefinition"><p>Arduino pin of case thermistor</p></td></tr><tr><td class="CDLEntry">tempCount</td><td class="CDLDefinition"><p>count of temperature reading taken, this is compared to the NUM_SAMPLES before an average is taken</p></td></tr></table></div>
</div>

<a name="convertToTemp"></a><a name="Topic18"></a><div class="CTopic TFunction LC">
 <div class="CTitle">convertToTemp</div>
 <div id="NDPrototype18" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">float</span> convertToTemp(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">adc</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Converts input from a thermistor analog to Kelvin temperature value.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">adc<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>raw value from analog pin</p></td></tr></table><div class="CHeading">Return</div><table class="CDefinitionList"><tr><td class="CDLEntry">temperature</td><td class="CDLDefinition"><p>in Kelvin</p></td></tr></table><div class="CHeading">Global Variables Needed</div><table class="CDefinitionList"><tr><td class="CDLEntry">INVT0</td><td class="CDLDefinition"><p>?</p></td></tr><tr><td class="CDLEntry">INVBETA</td><td class="CDLDefinition"><p>inverse of the thermistor Beta value supplied by manufacturer</p></td></tr></table></div>
</div>

<a name="convertKtoCF"></a><a name="Topic34"></a><div class="CTopic TFunction LC">
 <div class="CTitle">convertKtoCF</div>
 <div id="NDPrototype34" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">float</span> convertKtoCF(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">float</span>&nbsp;</td><td class="PName last">kelvin</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Converts convert Kelvin to Celcuis or Fahrenheit</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">kelvin<div class="CDLParameterType"><span class="SHKeyword">float</span></div></td><td class="CDLDefinition"><p>kelvin temp</p></td></tr></table><div class="CHeading">Return</div><p>temperature in Celcius or Fahrenheit (depending on global variable celcius)</p><div class="CHeading">Global Variables Needed</div><table class="CDefinitionList"><tr><td class="CDLEntry">celcius</td><td class="CDLDefinition"><p>true if Celcius, false if Fahrenheit</p></td></tr></table></div>
</div>

<a name="setup"></a><a name="Topic21"></a><div class="CTopic TFunction LC last">
 <div class="CTitle">setup</div>
 <div id="NDPrototype21" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> setup(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">void</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Sets the arduino pins, Initializes the Nextion display, Runs the Self Check routing.</p></div>
</div>

</body></html>